
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Buyback Portal</title>
  <style>
    .card-row { margin-bottom: 10px; }
    .card-row input, .card-row select { margin-right: 5px; }
    .remove-card { background: red; color: white; border: none; padding: 4px 8px; cursor: pointer; }
  </style>
</head>
<body>
  <h1>Submit Your Trade</h1>
  <form>
    <div id="card-container">
      <div class="card-row">
        <input type="text" name="cardName" placeholder="Card Name" required />
        <select name="condition">
          <option value="NM">NM</option>
          <option value="LP">LP</option>
          <option value="MP">MP</option>
        </select>
        <button type="button" class="remove-card">❌ Remove</button>
      </div>
    </div>
    <button type="button" id="add-card">➕ Add Card</button>
    <button type="submit">Submit Trade</button>
  </form>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const form = document.querySelector("form");
      const addBtn = document.getElementById("add-card");
      const container = document.getElementById("card-container");

      addBtn.addEventListener("click", () => {
        const row = document.createElement("div");
        row.className = "card-row";
        row.innerHTML = `
          <input type="text" name="cardName" placeholder="Card Name" required />
          <select name="condition">
            <option value="NM">NM</option>
            <option value="LP">LP</option>
            <option value="MP">MP</option>
          </select>
          <button type="button" class="remove-card">❌ Remove</button>
        `;
        container.appendChild(row);
      });

      container.addEventListener("click", (e) => {
        if (e.target.classList.contains("remove-card")) {
          e.target.parentElement.remove();
        }
      });

      form.addEventListener("submit", (e) => {
        e.preventDefault();
        const cards = [];
        document.querySelectorAll(".card-row").forEach(row => {
          const name = row.querySelector("input[name='cardName']").value.trim();
          const condition = row.querySelector("select[name='condition']").value;
          if (name) {
            cards.push({ cardName: name, condition });
          }
        });

        fetch("/.netlify/functions/buybackstep4", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ cards })
        })
        .then(res => res.json())
        .then(data => {
          console.log("Response:", data);
          alert("Trade submitted! Check console for debug info.");
        });
      });
    });
  </script>
</body>
</html>
